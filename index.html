<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herbal Store - Pakistan Leading Herbal Online Store</title>
    <style>
        /* General Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; line-height: 1.6; color: #333; background: #ffffff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        /* FIX: Added !important to ensure this style always hides the element */
        .hidden { display: none !important; }
        .btn { background: #000000; color: white; padding: 12px 30px; text-decoration: none; border-radius: 25px; display: inline-block; transition: all 0.3s; border: 2px solid #ffffff; cursor: pointer; }
        .btn:hover { background: #ffffff; color: #000000; transform: translateY(-2px); }
        .btn-primary { background: #7BC142; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s; width: 100%; }
        .btn-primary:hover { background: #6BA438; }
        .btn-secondary { background: #f39c12; color: white; }
        .btn-secondary:hover { background: #e67e22; color: white; }

        /* Header & Navigation */
        .top-banner { background: #d4cdcd; color: rgb(19, 0, 0); text-align: center; padding: 8px; font-size: 14px;font-weight: bold; }
        .header { background: #ffffff; color: rgb(250, 250, 250); padding: 0px 0; position: sticky; top: 0; z-index: 1500; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .header-tools { display: flex; align-items: center; justify-content: space-between; padding: 10px 20px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); position: relative; }
        .logo img { height: 80px; }
        .search-wrapper { position: absolute; left: 50%; transform: translateX(-50%); }
        .search-input { padding: 15px 20px; font-size: 14px; border-radius: 25px; border: 1px solid #ccc; outline: none; width: 500px; }
        .header-right-controls { display: flex; align-items: center; gap: 15px; }
        .auth-controls a { color:green; text-decoration: none; font-weight: bold; font-size: 14px; }
        .cart-total-display { font-weight: bold; color: #000000; }
        .cart-button { font-size: 20px; color: #000; background: #fff; height: 50px; width: 50px; border-radius: 50%; cursor: pointer; transition: background 0.3s; position: relative; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; }
        .cart-button:hover { background: #f0f0f0; }
        .cart-item-count-badge { position: absolute; top: -5px; right: -5px; background: #f39c12; color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .nav-container { max-width: 1500px; margin: 0px auto; background-color: #000; display: flex; justify-content: center; align-items: center; padding: 5px 0; text-align: center; }
        .nav-menu { display: flex; list-style: none; gap: 25px; justify-content: center; flex: 1; flex-wrap: wrap; }
        .nav-link { color: rgb(255, 253, 253); text-decoration: none; padding: 10px 0; text-transform: uppercase; font-size: 14px; transition: color 0.3s; }
        .nav-link:hover { color: #f39c12; }

        /* --- NEW: Image Slider Styles --- */
        .slider-container { max-width: 100%; margin: 0 auto; position: relative; overflow: hidden; }
        .slide { display: none; width: 100%; height: 500px; background-size: cover; background-position: center; }
        .slide-content { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; background-color: rgba(0, 0, 0, 0.5); padding: 20px; }
        .slide-content h1 { font-size: 48px; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); }
        .slide-content p { font-size: 20px; margin-bottom: 20px; }
        .prev, .next { cursor: pointer; position: absolute; top: 50%; width: auto; padding: 16px; margin-top: -22px; color: white; font-weight: bold; font-size: 24px; transition: 0.6s ease; border-radius: 0 3px 3px 0; user-select: none; background-color: rgba(0,0,0,0.4); }
        .next { right: 0; border-radius: 3px 0 0 3px; }
        .prev:hover, .next:hover { background-color: rgba(0,0,0,0.8); }
        .dots-container { text-align: center; padding: 10px; position: absolute; bottom: 10px; width: 100%; }
        .dot { cursor: pointer; height: 15px; width: 15px; margin: 0 2px; background-color: #bbb; border-radius: 50%; display: inline-block; transition: background-color 0.6s ease; }
        .active-dot, .dot:hover { background-color: #717171; }
        .fade { animation-name: fade; animation-duration: 1.5s; }
        @keyframes fade { from {opacity: .4} to {opacity: 1} }

        /* --- NEW: Collections Section --- */
        .collections-section { padding: 60px 0; text-align: center; }
        .collection-title { font-size: 28px; margin-bottom: 40px; color: #000000; position: relative; display: inline-block; }
        .collection-title::after { content: ''; display: block; width: 60px; height: 3px; background: #7BC142; margin: 8px auto 0; }
        .collection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 30px; }
        .collection-item { text-align: center; cursor: pointer; transition: transform 0.2s; }
        .collection-item:hover { transform: translateY(-5px); }
        .collection-image { width: 150px; height: 150px; border-radius: 50%; overflow: hidden; margin: 0 auto 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 3px solid #f0f0f0; }
        .collection-image img { width: 100%; height: 100%; object-fit: cover; }
        .collection-item h4 { font-size: 16px; color: #333; }

        /* Page & Section Styles */
        .page-header { background: #000000; color: white; padding: 40px 0; text-align: center; }
        .page-header h1 { font-size: 36px; }
        .page-content { padding: 60px 0; min-height: 60vh; }
        .section-title { text-align: center; font-size: 28px; margin-bottom: 30px; color: #000000; }

        /* Login/Auth Page */
        .auth-page { display: flex; justify-content: center; align-items: center; padding: 60px 20px; }
        .auth-container { background: #fff; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(38, 113, 3, 0.1); width: 100%; max-width: 400px; text-align: center; }
        .auth-container h2 { margin-bottom: 20px; }
        .auth-container .form-group { margin-bottom: 15px; text-align: left; }
        .auth-container label { display: block; margin-bottom: 5px; font-weight: bold; }
        .auth-container input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        .auth-container .btn-primary { margin-top: 10px; }
        .auth-container .toggle-auth { margin-top: 20px; font-size: 14px; }
        .auth-container .toggle-auth a { color: #7BC142; cursor: pointer; text-decoration: underline; }

        /* Admin Panel */
        .admin-panel { padding: 40px 0; }
        .admin-tabs { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 20px; }
        .admin-tab { padding: 10px 20px; cursor: pointer; background: #f1f1f1; }
        .admin-tab.active { background: #fff; border: 1px solid #ccc; border-bottom: none; font-weight: bold; }
        .admin-content { background: #fff; padding: 20px; border: 1px solid #ccc; border-top: none; }
        .order-record, .admin-product-card { background: #f9f9f9; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .order-record h4 { margin-bottom: 10px; }
        .order-record p { margin: 5px 0; font-size: 14px; }
        .order-details { white-space: pre-wrap; font-family: monospace; background: #fff; padding: 10px; border-radius: 5px; }
        .admin-product-form { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .admin-product-form .form-group { margin-bottom: 0; }
        /* Style for image preview in admin */
        .admin-product-form #image-preview { max-width: 100px; max-height: 100px; margin-top: 10px; border: 1px solid #ccc; padding: 5px; border-radius: 5px; }


        /* Custom Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); max-width: 90%; width: 400px; }
        .modal-content p { margin-bottom: 20px; font-size: 18px; }
        .modal-close-btn { background: #7BC142; color: white; padding: 10px 25px; }
        
        /* Product Grid & Cards */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .product-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; position: relative; display: flex; flex-direction: column; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .product-image { height: 180px; background: #ffffff; display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; } /* UPDATED for real images */
        .product-info { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
        .product-info h3 { font-size: 16px; margin-bottom: 8px; color: #000000; font-weight: 600; line-height: 1.3; flex-grow: 1; cursor: pointer; }
        .product-price { font-size: 18px; font-weight: bold; color: #f39c12; margin-bottom: 12px; }
        .price-original { font-size: 14px; color: #999; text-decoration: line-through; margin-right: 8px; }
        .quantity-controls { display: flex; align-items: center; justify-content: center; margin-bottom: 12px; }
        .quantity-btn { width: 32px; height: 32px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 18px; color: #666; }
        .quantity-input { width: 50px; height: 32px; border: 1px solid #ddd; border-left: none; border-right: none; text-align: center; font-size: 16px; outline: none; -moz-appearance: textfield; }
        .add-to-cart-btn { margin-top: auto; }

        /* Product Detail Page */
        .product-detail-container { display: grid; grid-template-columns: 1fr 1.2fr; gap: 40px; align-items: flex-start; }
        .product-detail-image { text-align: center; background: #f8f8f8; border-radius: 12px; padding: 40px; }
        .product-detail-image img { max-width: 100%; max-height: 300px; object-fit: contain;} /* UPDATED for real images */
        .product-detail-info h1 { font-size: 32px; margin-bottom: 15px; }
        .product-detail-info .product-price { font-size: 24px; }
        .product-detail-info p { margin-bottom: 20px; color: #666; }
        .product-detail-info .quantity-controls { justify-content: flex-start; }
        .back-link { display: inline-block; margin-bottom: 20px; color: #7BC142; text-decoration: none; font-weight: bold; }
        .back-link:hover { text-decoration: underline; }
        
        /* Cart Page */
        .cart-container { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; align-items: flex-start; }
        .cart-items { border: 1px solid #eee; border-radius: 8px; padding: 20px; }
        .cart-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #eee; }
        .cart-item:last-child { border-bottom: none; }
        .cart-item-details { display: flex; align-items: center; gap: 15px; }
        .cart-item-image { width: 60px; height: 60px; } /* UPDATED for real images */
        .cart-item-image img { width: 100%; height: 100%; object-fit: cover; border-radius: 5px;} /* UPDATED for real images */
        .cart-item-info h4 { margin-bottom: 5px; }
        .cart-item-price { color: #888; }
        .cart-item-actions { display: flex; align-items: center; gap: 10px; }
        .remove-from-cart-btn { background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
        .cart-summary { border: 1px solid #eee; border-radius: 8px; padding: 20px; position: sticky; top: 150px; }
        .cart-summary h3 { margin-bottom: 20px; }
        .cart-summary p { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .cart-summary .total { font-weight: bold; font-size: 1.2em; margin-top: 15px; }
        .cart-empty-message { text-align: center; font-size: 18px; color: #888; padding: 40px 0; }
        
        /* Checkout Page */
        .checkout-container { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: flex-start; }
        .checkout-form .form-group { margin-bottom: 20px; }
        .checkout-form label { display: block; margin-bottom: 5px; font-weight: bold; }
        .checkout-form input, .checkout-form textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        .order-summary { background: #f8f8f8; padding: 20px; border-radius: 8px; }
        .order-summary h3 { margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .summary-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .summary-total { margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd; font-weight: bold; font-size: 1.1em; display: flex; justify-content: space-between; }
        .payment-methods { margin-top: 30px; }
        .payment-method-tabs { display: flex; border-bottom: 1px solid #ccc; margin-bottom: 20px; }
        .payment-tab { padding: 10px 20px; cursor: pointer; border: 1px solid transparent; border-bottom: none; background: #f1f1f1; color: #666; border-radius: 5px 5px 0 0; }
        .payment-tab.active { background: #fff; border-color: #ccc; border-bottom-color: #fff; position: relative; top: 1px; color: #000; font-weight: bold; }
        .payment-content { padding: 15px; border: 1px solid #ccc; border-top: none; border-radius: 0 0 5px 5px; }
        .payment-warning { background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 14px; }

        /* Footer */
        .footer { background: #000000; color: white; text-align: center; padding: 40px 0; }

        /* Responsive */
        @media (max-width: 992px) {
            .cart-container, .checkout-container, .product-detail-container, .admin-product-form { grid-template-columns: 1fr; }
            .search-wrapper { position: static; transform: none; padding: 10px 20px; }
            .search-input { width: 100%; }
            .collection-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
            .collection-image { width: 120px; height: 120px; }
        }
        @media (max-width: 768px) {
            .nav-menu { gap: 15px; } .nav-link { font-size: 12px; }
            .header-tools { flex-wrap: wrap; justify-content: center; }
            .cart-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .slide { height: 300px; }
            .slide-content h1 { font-size: 32px; }
            .slide-content p { font-size: 16px; }
        }
    </style>
</head>
<body>
    <div id="custom-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <p id="modal-message">This is a message.</p>
            <button id="modal-close-btn" class="btn btn-primary modal-close-btn">Close</button>
        </div>
    </div>
    
    <header class="header">
        <div class="header-tools">
            <div class="logo"><a href="#" onclick="showPage('home')"><img src="images/logo.jpg" alt="Herbal Store Logo"></a></div>
            <div class="search-wrapper">
                <input type="search" id="search-input" class="search-input" placeholder="Search products...">
            </div>
            <div class="header-right-controls">
                <div id="auth-controls">
                    <a href="#" onclick="showPage('login')">Login</a>
                </div>
                <div class="cart-total-display">Total: PKR <span id="cart-total-header">0.00</span></div>
                <div class="cart-button" onclick="showPage('cart')"><img src="images/cart.png" alt="your cart" width="30" height="30">
                    <span class="cart-item-count-badge">0</span>
                </div>
            </div>
        </div>
        <div class="nav-container">
			<nav>
                <ul class="nav-menu">
                    <li><a href="#" class="nav-link" onclick="showPage('home')">HOME</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('dry-fruits')">DRY FRUITS</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('herbal-tea')">HERBAL TEA</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('honey')">HONEY</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('seeds')">SEEDS</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('supplements')">SUPPLEMENTS</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('capsules')">CAPSULES</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('cold-pressed-oil')">COLD PRESSED OIL</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('essential-oils')">ESSENTIAL OILS</a></li>
                    <li><a href="#" class="nav-link" onclick="showPage('deals')">DEALS</a></li>
                </ul>
            </nav>
        </div>
        <div class="top-banner">*Free Shipping For Order Above Rs.3000 **Pakistan's Leading Herbal Online Store</div>
    </header>

    <main>
        <div id="home-page" class="page">
            <div class="slider-container">
                <div class="slide fade" style="background-image: url('https://placehold.co/1600x500/2a9d8f/ffffff?text=Nature%27s+Remedies');">
                    <div class="slide-content">
                        <h1>Discover Nature's Finest Remedies</h1>
                        <p>Your trusted source for natural health and wellness products.</p>
                        <a href="#" onclick="showPage('supplements')" class="btn">Shop Now</a>
                    </div>
                </div>
                <div class="slide fade" style="background-image: url('https://placehold.co/1600x500/e9c46a/ffffff?text=Pure+Honey');">
                    <div class="slide-content">
                        <h1>Premium Quality Honey</h1>
                        <p>100% Pure and Organic Honey varieties.</p>
                        <a href="#" onclick="showPage('honey')" class="btn btn-secondary">Explore Honey</a>
                    </div>
                </div>
                <div class="slide fade" style="background-image: url('https://placehold.co/1600x500/f4a261/ffffff?text=Dry+Fruits');">
                    <div class="slide-content">
                        <h1>Fresh Dry Fruits</h1>
                        <p>Packed with nutrients for a healthy lifestyle.</p>
                        <a href="#" onclick="showPage('dry-fruits')" class="btn">View Collection</a>
                    </div>
                </div>
                <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                <a class="next" onclick="plusSlides(1)">&#10095;</a>
                <div class="dots-container">
                    <span class="dot" onclick="currentSlideDot(1)"></span>
                    <span class="dot" onclick="currentSlideDot(2)"></span>
                    <span class="dot" onclick="currentSlideDot(3)"></span>
                </div>
            </div>

            <section class="collections-section">
                <div class="container">
                    <h2 class="collection-title">Shop By Collection</h2>
                    <div class="collection-grid">
                        <div class="collection-item" onclick="showPage('dry-fruits')">
                            <div class="collection-image"><img src="https://placehold.co/150x150/f4a261/ffffff?text=Dry+Fruits" alt="Dry Fruits"></div>
                            <h4>Dry Fruits</h4>
                        </div>
                        <div class="collection-item" onclick="showPage('herbal-tea')">
                            <div class="collection-image"><img src="https://placehold.co/150x150/2a9d8f/ffffff?text=Herbal+Tea" alt="Herbal Tea"></div>
                            <h4>Herbal Tea</h4>
                        </div>
                        <div class="collection-item" onclick="showPage('honey')">
                            <div class="collection-image"><img src="https://placehold.co/150x150/e9c46a/ffffff?text=Honey" alt="Honey"></div>
                            <h4>Honey</h4>
                        </div>
                        <div class="collection-item" onclick="showPage('seeds')">
                            <div class="collection-image"><img src="https://placehold.co/150x150/e76f51/ffffff?text=Seeds" alt="Seeds"></div>
                            <h4>Seeds</h4>
                        </div>
                        <div class="collection-item" onclick="showPage('supplements')">
                            <div class="collection-image"><img src="https://placehold.co/150x150/8ab17d/ffffff?text=Supplements" alt="Supplements"></div>
                            <h4>Supplements</h4>
                        </div>
                         <div class="collection-item" onclick="showPage('essential-oils')">
                            <div class="collection-image"><img src="https://placehold.co/150x150/264653/ffffff?text=Oils" alt="Essential Oils"></div>
                            <h4>Essential Oils</h4>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="products page-content">
                <div class="container">
                    <h2 class="section-title">All Products</h2>
                    <div id="all-products-grid" class="product-grid"></div>
                </div>
            </section>
        </div>

        <div id="dry-fruits-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Dry Fruits</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="dry-fruits-grid"></div></div></div>
        </div>
        <div id="herbal-tea-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Herbal Tea</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="herbal-tea-grid"></div></div></div>
        </div>
        <div id="honey-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Honey</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="honey-grid"></div></div></div>
        </div>
        <div id="seeds-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Seeds</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="seeds-grid"></div></div></div>
        </div>
        <div id="supplements-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Supplements</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="supplements-grid"></div></div></div>
        </div>
        <div id="capsules-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Capsules</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="capsules-grid"></div></div></div>
        </div>
        <div id="cold-pressed-oil-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Cold Pressed Oil</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="cold-pressed-oil-grid"></div></div></div>
        </div>
        <div id="essential-oils-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Essential Oils</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="essential-oils-grid"></div></div></div>
        </div>
        <div id="deals-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Deals</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="deals-grid"></div></div></div>
        </div>

        <div id="search-results-page" class="page hidden">
            <div class="page-header"><div class="container"><h1 id="search-results-title">Search Results</h1></div></div>
            <div class="page-content"><div class="container"><div class="product-grid" id="search-results-grid"></div></div></div>
        </div>

        <div id="product-detail-page" class="page hidden">
            <div class="page-content">
                <div class="container" id="product-detail-content"></div>
            </div>
        </div>

        <div id="cart-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Shopping Cart</h1></div></div>
            <div class="page-content">
                <div class="container" id="cart-view-container"></div>
            </div>
        </div>

        <div id="checkout-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Checkout</h1></div></div>
            <div class="page-content">
                <div class="container checkout-container">
                    <div class="checkout-form">
                        <h3>Shipping Details</h3>
                        <form id="checkout-form-element" action="https://formspree.io/f/YOUR_FORM_ID" method="POST">
                            <div class="form-group"><label for="fullName">Full Name</label><input type="text" id="fullName" name="Full Name" required></div>
                            <div id="guest-email-group" class="form-group hidden"><label for="email">Email Address</label><input type="email" id="email" name="Email" required></div>
                            <div class="form-group"><label for="phone">Phone Number</label><input type="tel" id="phone" name="Phone Number" required></div>
                            <div class="form-group"><label for="address">Full Address</label><textarea id="address" name="Address" rows="4" required></textarea></div>
                            <div class="payment-methods">
                                <h3>Payment Method</h3>
                                <div class="payment-method-tabs"><div class="payment-tab active" onclick="showPaymentContent('cod')">Cash on Delivery</div><div class="payment-tab" onclick="showPaymentContent('easypaisa')">EasyPaisa</div><div class="payment-tab" onclick="showPaymentContent('card')">Card Payment</div></div>
                                <div id="cod-content" class="payment-content"><p>You will pay when your order is delivered.</p></div>
                                <div id="easypaisa-content" class="payment-content hidden"><p>Please transfer the total amount to the following EasyPaisa account and enter the Transaction ID below:</p><p><b>Account Title:</b> Herbal Store PK<br><b>Account Number:</b> 0300-1234567</p><div class="form-group" style="margin-top: 15px;"><label for="easypaisa-tid">Transaction ID (TID)</label><input type="text" id="easypaisa-tid" name="EasyPaisa TID" placeholder="Enter your payment TID"></div></div>
                                <div id="card-content" class="payment-content hidden"><div class="form-group"><label for="card-number">Card Number</label><input type="text" id="card-number" name="Card Number" placeholder="XXXX XXXX XXXX XXXX"></div><div class="form-group" style="display: flex; gap: 10px;"><div style="flex: 1;"><label for="card-expiry">Expiry (MM/YY)</label><input type="text" id="card-expiry" name="Card Expiry" placeholder="MM/YY"></div><div style="flex: 1;"><label for="card-cvc">CVC</label><input type="text" id="card-cvc" name="Card CVC" placeholder="XXX"></div></div><div class="payment-warning"><strong>For Demo Purposes Only.</strong> Do not enter real credit card information.</div></div>
                            </div>
                            <input type="hidden" name="Order Summary" id="order-summary-input"><input type="hidden" name="Payment Method" id="payment-method-input" value="Cash on Delivery"><input type="hidden" name="_subject" value="New Order from HerbalStore Website!"><button type="submit" class="btn-primary" style="margin-top: 20px;">Place Order</button>
                        </form>
                    </div>
                    <div class="order-summary"><h3>Your Order</h3><div id="checkout-summary-container"></div></div>
                </div>
            </div>
        </div>

        <div id="order-success-page" class="page hidden">
            <div class="page-content" style="text-align: center;">
                <div class="container">
                    <h2>âœ… Thank You!</h2><p>Your order has been placed successfully.</p><p>We will contact you shortly to confirm the details.</p><button class="btn-primary" style="margin-top: 20px; width: auto;" onclick="showPage('home'); cart = []; updateCartDisplay();">Continue Shopping</button>
                </div>
            </div>
        </div>

        <div id="login-page" class="page hidden">
            <div class="auth-page">
                <div class="auth-container">
                    <form id="login-form">
                        <h2>Login</h2>
                        <div class="form-group"><label for="login-email">Email</label><input type="email" id="login-email" required></div>
                        <div class="form-group"><label for="login-password">Password</label><input type="password" id="login-password" required></div>
                        <button type="submit" class="btn btn-primary">Login</button>
                        <p class="toggle-auth">Don't have an account? <a onclick="toggleAuthForms()">Sign Up</a></p>
                    </form>
                    <form id="signup-form" class="hidden">
                        <h2>Sign Up</h2>
                        <div class="form-group"><label for="signup-name">Name</label><input type="text" id="signup-name" required></div>
                        <div class="form-group"><label for="signup-email">Email</label><input type="email" id="signup-email" required></div>
                        <div class="form-group"><label for="signup-password">Password</label><input type="password" id="signup-password" required></div>
                        <button type="submit" class="btn btn-primary">Sign Up</button>
                        <p class="toggle-auth">Already have an account? <a onclick="toggleAuthForms()">Login</a></p>
                    </form>
                </div>
            </div>
        </div>

        <div id="admin-page" class="page hidden">
            <div class="page-header"><div class="container"><h1>Admin Panel</h1></div></div>
            <div class="page-content">
                <div class="container admin-panel">
                    <div class="admin-tabs">
                        <div class="admin-tab active" onclick="showAdminContent('orders')">Orders</div>
                        <div class="admin-tab" onclick="showAdminContent('products')">Add Product</div>
                    </div>
                    <div id="admin-orders-content" class="admin-content">
                        <h3 style="margin-bottom: 20px;">Received Orders</h3>
                        <div id="orders-list"></div>
                    </div>
                    <div id="admin-products-content" class="admin-content hidden">
                        <h3 style="margin-bottom: 20px;">Add a New Product</h3>
                        <form id="add-product-form">
                            <div class="admin-product-form">
                                <div class="form-group"><label for="product-name">Product Name</label><input type="text" id="product-name" required></div>
                                <div class="form-group"><label for="product-price">Price (PKR)</label><input type="number" id="product-price" required></div>
                                <div class="form-group"><label for="product-category">Category</label>
                                    <select id="product-category" required style="width:100%; padding:12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;">
                                        <option value="dry-fruits">Dry Fruits</option><option value="herbal-tea">Herbal Tea</option><option value="honey">Honey</option><option value="seeds">Seeds</option><option value="supplements">Supplements</option><option value="capsules">Capsules</option><option value="cold-pressed-oil">Cold Pressed Oil</option><option value="essential-oils">Essential Oils</option><option value="deals">Deals</option>
                                    </select>
                                </div>
                                <div class="form-group"><label for="product-image">Image</label><input type="file" id="product-image" accept="image/*" required><img id="image-preview" src="#" alt="Image Preview" class="hidden"/></div>
                                <div class="form-group" style="grid-column: 1 / -1;"><label for="product-description">Description</label><textarea id="product-description" rows="4" required></textarea></div>
                            </div>
                            <button type="submit" class="btn btn-primary" style="margin-top: 20px; width: auto;">Add Product</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Herbal Store. All rights reserved. | Pakistan's Leading Herbal Online Store</p>
        </div>
    </footer>

    <script>
    // --- DATABASE ---
    let allProducts = [];
    // UPDATED: Reduced product list to one per category.
    // NOTE: Image paths are placeholders. For a real deployment, ensure images exist in an 'images' folder.
    const initialProducts = [
        // Dry Fruits
        { id: 1, name: "Kashmiri Almonds (250g)", price: 2200, category: "dry-fruits", image: "https://placehold.co/300x300/f4a261/ffffff?text=Almonds", description: "Fresh and crunchy Kashmiri almonds, packed with nutrients." },
        // Herbal Tea
        { id: 11, name: "Chamomile Tea (20 bags)", price: 750, category: "herbal-tea", image: "https://placehold.co/300x300/2a9d8f/ffffff?text=Chamomile+Tea", description: "Calming chamomile tea to help you relax and unwind." },
        // Honey
        { id: 16, name: "Sidr Honey (250g)", price: 3500, category: "honey", image: "https://placehold.co/300x300/e9c46a/ffffff?text=Sidr+Honey", description: "Premium and rare Sidr honey with medicinal properties." },
        // Seeds
        { id: 21, name: "Chia Seeds (200g)", price: 950, category: "seeds", image: "https://placehold.co/300x300/e76f51/ffffff?text=Chia+Seeds", description: "Nutrient-dense chia seeds, high in fiber and omega-3." },
        // Supplements
        { id: 26, name: "Moringa Powder (100g)", price: 1200, category: "supplements", image: "https://placehold.co/300x300/8ab17d/ffffff?text=Moringa", description: "A superfood packed with vitamins, minerals, and antioxidants." },
        // Capsules
        { id: 30, name: "Black Seed Oil Capsules (60 caps)", price: 2200, category: "capsules", image: "https://placehold.co/300x300/264653/ffffff?text=Capsules", description: "Convenient capsules for immune support and overall wellness." },
        // Cold Pressed Oil
        { id: 33, name: "Black Seed Oil (100ml)", price: 1800, category: "cold-pressed-oil", image: "https://placehold.co/300x300/5E4E3E/ffffff?text=Black+Seed+Oil", description: "Cold-pressed Kalonji oil for various health benefits." },
        // Essential Oils
        { id: 37, name: "Lavender Essential Oil (10ml)", price: 1100, category: "essential-oils", image: "https://placehold.co/300x300/8A79B3/ffffff?text=Lavender+Oil", description: "Calming and relaxing lavender oil for aromatherapy." },
        // Deals
        { id: 41, name: "Wellness Bundle Deal", price: 4500, originalPrice: 5200, category: "deals", image: "https://placehold.co/300x300/7BC142/ffffff?text=Deal", description: "Includes Moringa Powder, Ashwagandha, and Sidr Honey." }
    ];


    // --- STATE MANAGEMENT ---
    let cart = [];
    let lastViewedCategory = 'home';
    let currentUser = null;
    let slideIndex = 1; // For slider
    let slideInterval; // For slider auto-play

    // --- DOM ELEMENTS ---
    const pages = document.querySelectorAll('.page');
    const cartTotalHeaderEl = document.getElementById('cart-total-header');
    const cartItemCountBadgeEl = document.querySelector('.cart-item-count-badge');
    const cartViewContainerEl = document.getElementById('cart-view-container');
    const checkoutFormEl = document.getElementById('checkout-form-element');
    const productDetailContentEl = document.getElementById('product-detail-content');
    const searchInputEl = document.getElementById('search-input');
    const authControlsEl = document.getElementById('auth-controls');
    const loginFormEl = document.getElementById('login-form');
    const signupFormEl = document.getElementById('signup-form');
    const ordersListEl = document.getElementById('orders-list');
    const addProductFormEl = document.getElementById('add-product-form');
    const modalEl = document.getElementById('custom-modal');
    const modalMessageEl = document.getElementById('modal-message');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const imagePreviewEl = document.getElementById('image-preview');

    // --- RENDER FUNCTIONS ---
    function renderAllGrids() {
        renderProducts(allProducts, 'all-products-grid'); 
        renderProducts(allProducts.filter(p => p.category === 'dry-fruits'), 'dry-fruits-grid');
        renderProducts(allProducts.filter(p => p.category === 'herbal-tea'), 'herbal-tea-grid');
        renderProducts(allProducts.filter(p => p.category === 'honey'), 'honey-grid');
        renderProducts(allProducts.filter(p => p.category === 'seeds'), 'seeds-grid');
        renderProducts(allProducts.filter(p => p.category === 'supplements'), 'supplements-grid');
        renderProducts(allProducts.filter(p => p.category === 'capsules'), 'capsules-grid');
        renderProducts(allProducts.filter(p => p.category === 'cold-pressed-oil'), 'cold-pressed-oil-grid');
        renderProducts(allProducts.filter(p => p.category === 'essential-oils'), 'essential-oils-grid');
        renderProducts(allProducts.filter(p => p.category === 'deals'), 'deals-grid');
    }

    function renderProducts(productsToRender, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;

        if (productsToRender.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #888;">No products found in this category.</p>';
            return;
        }
        
        // UPDATED: Now uses <img> tag for product image
        container.innerHTML = productsToRender.map(p => `
            <div class="product-card">
                <div class="product-image" onclick="showProductPage(${p.id})"><img src="${p.image}" alt="${p.name}"></div>
                <div class="product-info">
                    <h3 onclick="showProductPage(${p.id})">${p.name}</h3>
                    <div class="product-price">
                        ${p.originalPrice ? `<span class="price-original">Rs.${p.originalPrice.toFixed(2)}</span>` : ''}
                        Rs.${p.price.toFixed(2)}
                    </div>
                    <div class="quantity-controls" data-product-id="${p.id}">
                        <button class="quantity-btn">-</button>
                        <input type="number" class="quantity-input" value="1" min="1">
                        <button class="quantity-btn">+</button>
                    </div>
                    <button class="btn-primary add-to-cart-btn" data-product-id="${p.id}">ADD TO CART</button>
                </div>
            </div>
        `).join('');
    }
    
    function renderProductDetailPage(product) {
        if (!product) {
            productDetailContentEl.innerHTML = '<p>Product not found.</p>';
            return;
        }
        // UPDATED: Uses <img> tag for detail image
        productDetailContentEl.innerHTML = `<a href="#" onclick="showPage(lastViewedCategory)" class="back-link">&larr; Back to products</a><div class="product-detail-container"><div class="product-detail-image"><img src="${product.image}" alt="${product.name}"></div><div class="product-detail-info"><h1>${product.name}</h1><div class="product-price">${product.originalPrice ? `<span class="price-original">Rs.${product.originalPrice.toFixed(2)}</span>` : ''}Rs.${product.price.toFixed(2)}</div><p>${product.description || 'No description available.'}</p><div class="quantity-controls" data-product-id="${product.id}"><button class="quantity-btn">-</button><input type="number" class="quantity-input" value="1" min="1"><button class="quantity-btn">+</button></div><button class="btn-primary add-to-cart-btn" data-product-id="${product.id}" style="margin-top: 20px; width: auto;">ADD TO CART</button></div></div>`;
    }

    // --- PAGE NAVIGATION ---
    function showPage(pageId, searchTitle = '') {
        pages.forEach(page => page.classList.add('hidden'));
        const targetPage = document.getElementById(pageId + '-page');
        if (targetPage) {
            targetPage.classList.remove('hidden');
            if (!['cart', 'checkout', 'product-detail', 'order-success', 'login', 'admin', 'search-results'].includes(pageId)) {
                lastViewedCategory = pageId;
            }
        }
        if (pageId === 'search-results') {
            document.getElementById('search-results-title').textContent = searchTitle;
        }
        window.scrollTo(0, 0);

        if (pageId === 'checkout') renderCheckoutPage();
        if (pageId === 'admin') renderAdminPanel();
    }

    function showProductPage(productId) {
        const product = allProducts.find(p => p.id === productId);
        renderProductDetailPage(product);
        showPage('product-detail');
    }
    
    // --- SLIDER LOGIC ---
    function plusSlides(n) {
        showSlides(slideIndex += n);
        resetSlideInterval();
    }

    function currentSlideDot(n) {
        showSlides(slideIndex = n);
        resetSlideInterval();
    }

    function showSlides(n) {
        let i;
        let slides = document.getElementsByClassName("slide");
        let dots = document.getElementsByClassName("dot");
        if (n > slides.length) {slideIndex = 1}
        if (n < 1) {slideIndex = slides.length}
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(" active-dot", "");
        }
        slides[slideIndex-1].style.display = "block";
        dots[slideIndex-1].className += " active-dot";
    }
    
    function resetSlideInterval() {
        clearInterval(slideInterval);
        slideInterval = setInterval(() => plusSlides(1), 5000); 
    }

    // --- CART LOGIC ---
    function addToCart(productId, quantity) {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;
        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            cart.push({ ...product, quantity: quantity });
        }
        updateCartDisplay();
        showAlert(`${product.name} added to cart!`);
    }

    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateCartDisplay();
    }

    function updateCartDisplay() {
        renderCartPage();
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        cartTotalHeaderEl.textContent = total.toFixed(2);
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartItemCountBadgeEl.textContent = totalItems;
    }

    function renderCartPage() {
        if (!cartViewContainerEl) return;
        if (cart.length === 0) {
            cartViewContainerEl.innerHTML = '<p class="cart-empty-message">Your cart is currently empty.</p>';
            return;
        }
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        // UPDATED: Uses <img> tag for cart item image
        cartViewContainerEl.innerHTML = `<div class="cart-container"><div class="cart-items">${cart.map(item => `<div class="cart-item"><div class="cart-item-details"><div class="cart-item-image"><img src="${item.image}" alt="${item.name}"></div><div class="cart-item-info"><h4>${item.name}</h4><p class="cart-item-price">Rs.${item.price.toFixed(2)} x ${item.quantity}</p></div></div><div class="cart-item-actions"><strong>Rs.${(item.price * item.quantity).toFixed(2)}</strong><button class="remove-from-cart-btn" data-product-id="${item.id}">Remove</button></div></div>`).join('')}</div><div class="cart-summary"><h3>Order Summary</h3><p><span>Subtotal</span> <span>Rs.${total.toFixed(2)}</span></p><p><span>Shipping</span> <span>${total >= 3000 ? 'Free' : 'Rs.200'}</span></p><hr><p class="total"><span>Total</span> <span>Rs.${(total + (total < 3000 ? 200 : 0)).toFixed(2)}</span></p><button class="btn-primary" onclick="showPage('checkout')">Proceed to Checkout</button></div></div>`;
    }

    // --- CHECKOUT LOGIC ---
    function renderCheckoutPage() {
        const guestEmailGroup = document.getElementById('guest-email-group');
        const emailInput = document.getElementById('email');

        // UPDATED: Removed mandatory login. Show email field if not logged in.
        if (!currentUser) {
            guestEmailGroup.classList.remove('hidden');
            emailInput.required = true;
        } else {
            guestEmailGroup.classList.add('hidden');
            emailInput.required = false;
        }

        const summaryContainer = document.getElementById('checkout-summary-container');
        if (!summaryContainer) return;
        if (cart.length === 0) {
            showPage('cart');
            return;
        }
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const shipping = subtotal >= 3000 ? 0 : 200;
        const total = subtotal + shipping;
        summaryContainer.innerHTML = `${cart.map(item => `<div class="summary-item"><span>${item.name} (x${item.quantity})</span><span>Rs.${(item.price * item.quantity).toFixed(2)}</span></div>`).join('')}<div class="summary-item" style="margin-top: 10px;"><span>Subtotal</span><span>Rs.${subtotal.toFixed(2)}</span></div><div class="summary-item"><span>Shipping</span><span>Rs.${shipping.toFixed(2)}</span></div><div class="summary-total"><span>Total</span><span>Rs.${total.toFixed(2)}</span></div>`;
    }
    
    function showPaymentContent(method) {
        document.querySelectorAll('.payment-content').forEach(el => el.classList.add('hidden'));
        document.getElementById(`${method}-content`).classList.remove('hidden');
        document.querySelectorAll('.payment-tab').forEach(el => el.classList.remove('active'));
        document.querySelector(`.payment-tab[onclick="showPaymentContent('${method}')"]`).classList.add('active');
        const paymentMethodInput = document.getElementById('payment-method-input');
        if(method === 'cod') paymentMethodInput.value = 'Cash on Delivery';
        if(method === 'easypaisa') paymentMethodInput.value = 'EasyPaisa';
        if(method === 'card') paymentMethodInput.value = 'Card Payment';
    }

    function prepareOrderForSubmission() {
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const shipping = subtotal >= 3000 ? 0 : 200;
        const total = subtotal + shipping;
        let orderString = "Order Details:\n\n";
        cart.forEach(item => { orderString += `${item.name} | Qty: ${item.quantity} | Price: Rs.${item.price.toFixed(2)} | Subtotal: Rs.${(item.price * item.quantity).toFixed(2)}\n`; });
        orderString += `\n----------------------------------\nSubtotal: Rs.${subtotal.toFixed(2)}\nShipping: Rs.${shipping.toFixed(2)}\nGRAND TOTAL: Rs.${total.toFixed(2)}`;
        document.getElementById('order-summary-input').value = orderString;
        return { orderString, total };
    }
    
    function saveOrderToLocalStorage() {
        const { orderString, total } = prepareOrderForSubmission();
        const paymentMethod = document.getElementById('payment-method-input').value;
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        
        const newOrder = {
            date: new Date().toISOString(),
            customer: {
                name: document.getElementById('fullName').value,
                email: currentUser ? currentUser.email : document.getElementById('email').value, // Use form email if guest
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
            },
            summary: orderString,
            paymentMethod: paymentMethod,
            total: total
        };
        orders.push(newOrder);
        localStorage.setItem('orders', JSON.stringify(orders));
    }


    // --- AUTHENTICATION & ADMIN ---
    function toggleAuthForms() {
        loginFormEl.classList.toggle('hidden');
        signupFormEl.classList.toggle('hidden');
    }

    function updateAuthControls() {
        if (currentUser) {
            let welcomeMessage = `Welcome, ${currentUser.name}`;
            if (currentUser.role === 'admin') {
                welcomeMessage += ` | <a href="#" onclick="showPage('admin')">Admin Panel</a>`;
            }
            welcomeMessage += ` | <a href="#" onclick="logout()">Logout</a>`;
            authControlsEl.innerHTML = welcomeMessage;
        } else {
            authControlsEl.innerHTML = `<a href="#" onclick="showPage('login')">Login</a>`;
        }
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        updateAuthControls();
        showPage('home');
        showAlert("You have been logged out.");
    }

    function renderAdminPanel() {
        if (!currentUser || currentUser.role !== 'admin') {
            showAlert("You do not have permission to view this page.");
            showPage('home');
            return;
        }
        renderOrders();
    }
    
    function showAdminContent(contentType) {
        document.querySelectorAll('.admin-content').forEach(el => el.classList.add('hidden'));
        document.getElementById(`admin-${contentType}-content`).classList.remove('hidden');
        document.querySelectorAll('.admin-tab').forEach(el => el.classList.remove('active'));
        document.querySelector(`.admin-tab[onclick="showAdminContent('${contentType}')"]`).classList.add('active');
    }

    function renderOrders() {
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        if (orders.length === 0) {
            ordersListEl.innerHTML = '<p>No orders received yet.</p>';
            return;
        }
        ordersListEl.innerHTML = orders.map(order => `
            <div class="order-record">
                <h4>Order from: ${order.customer.name}</h4>
                <p><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</p>
                <p><strong>Contact:</strong> ${order.customer.email} | ${order.customer.phone}</p>
                <p><strong>Address:</strong> ${order.customer.address}</p>
                <p><strong>Payment Method:</strong> ${order.paymentMethod}</p>
                <details>
                    <summary>View Order Details</summary>
                    <pre class="order-details">${order.summary}</pre>
                </details>
            </div>
        `).reverse().join('');
    }

    // --- MODAL & SEARCH ---
    function showAlert(message) {
        modalMessageEl.textContent = message;
        modalEl.classList.remove('hidden');
    }

    function handleSearch() {
        const query = searchInputEl.value.toLowerCase().trim();
        if (query.length < 2) {
            if (query.length === 0) showPage(lastViewedCategory || 'home');
            return;
        }
        const results = allProducts.filter(p => p.name.toLowerCase().includes(query) || p.description.toLowerCase().includes(query));
        renderProducts(results, 'search-results-grid');
        showPage('search-results', `Results for "${query}"`);
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-to-cart-btn')) {
            const controls = e.target.closest('.product-info, .product-detail-info');
            const productId = parseInt(e.target.dataset.productId);
            const quantity = parseInt(controls.querySelector('.quantity-input').value);
            addToCart(productId, quantity);
        }
        if (e.target.classList.contains('quantity-btn')) {
            const input = e.target.parentNode.querySelector('.quantity-input');
            let value = parseInt(input.value);
            if (e.target.textContent === '+') value++;
            else if (value > 1) value--;
            input.value = value;
        }
        if (e.target.classList.contains('remove-from-cart-btn')) {
            const productId = parseInt(e.target.dataset.productId);
            removeFromCart(productId);
        }
    });

    modalCloseBtn.addEventListener('click', () => modalEl.classList.add('hidden'));
    modalEl.addEventListener('click', (e) => { if(e.target === modalEl) modalEl.classList.add('hidden'); });

    searchInputEl.addEventListener('keyup', handleSearch);

    loginFormEl.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        // Admin Login
        if (email === 'admin@gmail.com' && password === 'admin123') {
            currentUser = { name: 'Admin', email: 'admin@gmail.com', role: 'admin' };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateAuthControls();
            showPage('admin');
            return;
        }
        // Regular User Login
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const user = users.find(u => u.email === email && u.password === password);
        if (user) {
            currentUser = user;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateAuthControls();
            showPage('home');
        } else {
            showAlert("Invalid email or password.");
        }
    });

    signupFormEl.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('signup-name').value;
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;
        let users = JSON.parse(localStorage.getItem('users')) || [];
        if (users.some(u => u.email === email)) {
            showAlert("An account with this email already exists.");
            return;
        }
        const newUser = { name, email, password, role: 'customer' };
        users.push(newUser);
        localStorage.setItem('users', JSON.stringify(users));
        showAlert("Signup successful! Please login.");
        toggleAuthForms();
    });

    checkoutFormEl.addEventListener('submit', function(e) {
        e.preventDefault();
        const paymentMethod = document.getElementById('payment-method-input').value;
        
        // Form validation for other methods
        if(paymentMethod === 'EasyPaisa' && !document.getElementById('easypaisa-tid').value) {
            showAlert('Please enter the EasyPaisa Transaction ID (TID).');
            return;
        }

        // UPDATED: Fix for COD orders
        if (paymentMethod === 'Cash on Delivery') {
            saveOrderToLocalStorage();
            showPage('order-success');
            cart = [];
            updateCartDisplay();
            checkoutFormEl.reset();
            return; // Stop execution to prevent fetch
        }

        // For other methods, use Formspree (or other backend service)
        // Note: The form action URL 'https://formspree.io/f/YOUR_FORM_ID' is a placeholder.
        // You must replace 'YOUR_FORM_ID' with your actual Formspree form ID for this to work.
        saveOrderToLocalStorage(); // Also save to local storage for admin view
        const formData = new FormData(checkoutFormEl);
        fetch(checkoutFormEl.action, { method: 'POST', body: formData, headers: { 'Accept': 'application/json' }})
        .then(response => {
            if (response.ok) {
                showPage('order-success');
                cart = [];
                updateCartDisplay();
                checkoutFormEl.reset();
            } else {
                 showAlert('There was a problem with your submission. Please try again.');
            }
        }).catch(error => showAlert('There was a network problem. Please try again.'));
    });
    
    // UPDATED: Admin form handler for image upload
    document.getElementById('product-image').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                imagePreviewEl.src = event.target.result;
                imagePreviewEl.classList.remove('hidden');
            }
            reader.readAsDataURL(file);
        }
    });

    addProductFormEl.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // This uses a FileReader to get the image as a Base64 data URL.
        // This is a front-end simulation. A real application would upload the file to a server.
        const imageFile = document.getElementById('product-image').files[0];
        if (!imageFile) {
            showAlert("Please select an image for the product.");
            return;
        }

        const reader = new FileReader();
        reader.onloadend = function() {
            const newProduct = {
                id: Date.now(), // Simple unique ID
                name: document.getElementById('product-name').value,
                price: parseFloat(document.getElementById('product-price').value),
                category: document.getElementById('product-category').value,
                image: reader.result, // The Base64 data URL
                description: document.getElementById('product-description').value,
            };
            allProducts.push(newProduct);
            localStorage.setItem('products', JSON.stringify(allProducts));
            renderAllGrids();
            showAlert("Product added successfully!");
            addProductFormEl.reset();
            imagePreviewEl.classList.add('hidden');
        };
        reader.readAsDataURL(imageFile);
    });

    // --- INITIALIZATION ---
    function initializeStore() {
        const storedProducts = JSON.parse(localStorage.getItem('products'));
        if (storedProducts && storedProducts.length > 0) {
            allProducts = storedProducts;
        } else {
            allProducts = initialProducts; // Fallback to initial list
        }
        const loggedInUser = JSON.parse(localStorage.getItem('currentUser'));
        if (loggedInUser) {
            currentUser = loggedInUser;
        }
        renderAllGrids();
        updateCartDisplay();
        updateAuthControls();
        
        showSlides(slideIndex);
        resetSlideInterval();
    }

    // Run the store
    initializeStore();
    </script>
</body>
</html>